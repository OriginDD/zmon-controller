describe('CloudCtrl', function() {
    var scope, controller, httpBackend;

    beforeEach(function() {

        // Fake the module's UserInfoService dependency
        angular.mock.module('zmon2App', function($provide) {
            $provide.factory('UserInfoService', function() {
                return {
                    get: function() {
                        return {
                            'fakeKey': 'fakeValue'
                        };
                    }
                };
            });
        });

        angular.mock.inject(function($rootScope, $controller, $httpBackend) {
            scope = $rootScope.$new();

            controller = $controller('CloudCtrl', {
                $scope: scope
            });

            httpBackend = $httpBackend;
            httpBackend.when('GET', 'rest/entities/?query=%7B%22type%22%3A%22application%22%7D')
                .respond([{"id": "a-pennybags-zmon[aws:368335482178:eu-west-1]", "type": "application", "region": "eu-west-1", "created_by": "agent", "scalyr_ts_id": "ZOkTxIxmDrl30upy", "application_id": "pennybags-zmon", "infrastructure_account": "aws:368335482178"},{"id": "a-lawang[aws:352469958076:eu-west-1]", "type": "application", "region": "eu-west-1", "created_by": "agent", "application_id": "lawang", "infrastructure_account": "aws:352469958076"},{"id": "a-zmon-stups-test[aws:085668006708:eu-central-1]", "type": "application", "region": "eu-central-1", "created_by": "agent", "scalyr_ts_id": "t_gchbnEeGX846bj", "application_id": "zmon-stups-test", "infrastructure_account": "aws:085668006708"},{"id": "a-aruha-event-store-poc[aws:257146137867:eu-west-1]", "type": "application", "region": "eu-west-1", "created_by": "agent", "application_id": "aruha-event-store-poc", "infrastructure_account": "aws:257146137867"},{"id": "a-saiki-exhibitor[aws:222970907460:eu-west-1]", "type": "application", "region": "eu-west-1", "created_by": "agent", "application_id": "saiki-exhibitor", "infrastructure_account": "aws:222970907460"},{"id": "a-zmon-stups-test[aws:085668006708:eu-west-1]", "type": "application", "region": "eu-west-1", "created_by": "agent", "scalyr_ts_id": "t_gchbnEeGX846bj", "application_id": "zmon-stups-test", "infrastructure_account": "aws:085668006708"}]);

            httpBackend.when('GET', 'rest/entities/?query=%7B%22type%22%3A%22team%22%7D')
                .respond([{"dn": "cn=PowerUser,ou=Roles,ou=aws-zalando-617751694391,ou=AWS,ou=apps,dc=zalando,dc=net", "id": "zalando[team-service]", "name": "zalando", "type": "team", "team_id": "zalando"},{"dn": "cn=PowerUser,ou=Roles,ou=aws-labelmaker-452694139634,ou=AWS,ou=apps,dc=zalando,dc=net", "id": "labelmaker[team-service]", "name": "labelmaker", "type": "team", "team_id": "labelmaker"},{"dn": "cn=PowerUser,ou=Roles,ou=aws-pennybags-368335482178,ou=AWS,ou=apps,dc=zalando,dc=net", "id": "pennybags[team-service]", "name": "pennybags", "type": "team", "team_id": "pennybags"},{"dn": "cn=PowerUser,ou=Roles,ou=aws-ncng-067689663776,ou=AWS,ou=apps,dc=zalando,dc=net", "id": "ncng[team-service]", "name": "ncng", "type": "team", "team_id": "ncng"},{"dn": "cn=PowerUser,ou=Roles,ou=aws-mop-943018075884,ou=AWS,ou=apps,dc=zalando,dc=net", "id": "mop[team-service]", "name": "mop", "type": "team", "team_id": "mop"},{"dn": "cn=PowerUser,ou=Roles,ou=aws-cirrus-681709283245,ou=AWS,ou=apps,dc=zalando,dc=net", "id": "cirrus[team-service]", "name": "cirrus", "type": "team", "team_id": "cirrus"},{"dn": "cn=PowerUser,ou=Roles,ou=aws-einkaufshelden-477765547384,ou=AWS,ou=apps,dc=zalando,dc=net", "id": "einkaufshelden[team-service]", "name": "einkaufshelden", "type": "team", "team_id": "einkaufshelden"}]);

            httpBackend.when('GET', 'rest/entities/?query=%7B%22type%22%3A%22instance%22%7D')
                .respond([{"id": "i-8735892d[aws:352469958076:eu-west-1]", "ip": "172.31.173.179", "host": "ip-172-31-173-179.eu-west-1.compute.internal", "type": "instance", "stack": "banyu-2", "region": "eu-west-1", "source": "pierone.stups.zalan.do/saiki/banyu:0.5", "runtime": "Docker", "created_by": "agent", "resource_id": "AppServer", "instance_type": "t2.micro", "application_id": "banyu", "application_version": "", "infrastructure_account": "aws:352469958076"},{"id": "edi-bunny-Federation2-8tK6x[aws:681709283245:eu-west-1]", "ip": "172.31.136.132", "host": "ip-172-31-136-132.eu-west-1.compute.internal", "type": "instance", "ports": {"4369": 4369, "5672": 5672, "15672": 15672, "25672": 25672}, "stack": "edi-bunny-Federation2", "aws_id": "i-5a2c9ff0", "region": "eu-west-1", "source": "pierone.stups.zalan.do/cirrus/edi-bunny:0.5-SNAPSHOT", "runtime": "Docker", "created_by": "agent", "resource_id": "AppServer", "instance_type": "m3.medium", "application_id": "edi-bunny", "application_version": "Federation2", "infrastructure_account": "aws:681709283245"},{"id": "i-233d8189[aws:352469958076:eu-west-1]", "ip": "172.31.164.56", "url": "ip-172-31-164-56.eu-west-1.compute.internal:9000", "host": "ip-172-31-164-56.eu-west-1.compute.internal", "type": "instance", "ports": {"9000": 9000}, "stack": "lawang-2", "region": "eu-west-1", "source": "pierone.stups.zalan.do/saiki/lawang:0.6", "runtime": "Docker", "created_by": "agent", "resource_id": "AppServer", "instance_type": "t2.micro", "application_id": "lawang", "application_version": "", "infrastructure_account": "aws:352469958076"}]);

            httpBackend.when('GET', 'rest/entities/?query=%7B%22type%22%3A%22elb%22%7D')
                .respond([{"id": "elb-dev-aws-idm[aws:356702503974:eu-west-1]", "url": "https://dev-aws-idm-1118612655.eu-west-1.elb.amazonaws.com", "host": "dev-aws-idm-1118612655.eu-west-1.elb.amazonaws.com", "name": "dev-aws-idm", "type": "elb", "region": "eu-west-1", "scheme": "internet-facing", "dns_name": "dev-aws-idm-1118612655.eu-west-1.elb.amazonaws.com", "created_by": "agent", "stack_name": "dev-aws", "stack_version": "idm", "infrastructure_account": "aws:356702503974"},{"id": "elb-service-registry-7[aws:075097227389:eu-west-1]", "url": "https://service-registry-7-738588191.eu-west-1.elb.amazonaws.com", "host": "service-registry-7-738588191.eu-west-1.elb.amazonaws.com", "name": "service-registry-7", "type": "elb", "region": "eu-west-1", "scheme": "internet-facing", "dns_name": "service-registry-7-738588191.eu-west-1.elb.amazonaws.com", "created_by": "agent", "stack_name": "service-registry", "stack_version": "7", "infrastructure_account": "aws:075097227389"},{"id": "elb-test-aws-djemp[aws:356702503974:eu-west-1]", "url": "https://internal-test-aws-djemp-1011678277.eu-west-1.elb.amazonaws.com", "host": "internal-test-aws-djemp-1011678277.eu-west-1.elb.amazonaws.com", "name": "test-aws-djemp", "type": "elb", "region": "eu-west-1", "scheme": "internal", "dns_name": "internal-test-aws-djemp-1011678277.eu-west-1.elb.amazonaws.com", "created_by": "agent", "stack_name": "test-aws", "stack_version": "djemp", "infrastructure_account": "aws:356702503974"},{"id": "elb-dev-aws-djcts[aws:356702503974:eu-west-1]", "url": "https://internal-dev-aws-djcts-1850099153.eu-west-1.elb.amazonaws.com", "host": "internal-dev-aws-djcts-1850099153.eu-west-1.elb.amazonaws.com", "name": "dev-aws-djcts", "type": "elb", "region": "eu-west-1", "scheme": "internal", "dns_name": "internal-dev-aws-djcts-1850099153.eu-west-1.elb.amazonaws.com", "created_by": "agent", "stack_name": "dev-aws", "stack_version": "djcts", "infrastructure_account": "aws:356702503974"},{"id": "elb-si-stab-3[aws:007149717068:eu-west-1]", "url": "https://si-stab-3-2031935632.eu-west-1.elb.amazonaws.com", "host": "si-stab-3-2031935632.eu-west-1.elb.amazonaws.com", "name": "si-stab-3", "type": "elb", "region": "eu-west-1", "dns_name": "si-stab-3-2031935632.eu-west-1.elb.amazonaws.com", "created_by": "agent", "infrastructure_account": "aws:007149717068"},{"id": "elb-dev-aws-djcfg[aws:356702503974:eu-west-1]", "url": "https://internal-dev-aws-djcfg-1097888251.eu-west-1.elb.amazonaws.com", "host": "internal-dev-aws-djcfg-1097888251.eu-west-1.elb.amazonaws.com", "name": "dev-aws-djcfg", "type": "elb", "region": "eu-west-1", "scheme": "internal", "dns_name": "internal-dev-aws-djcfg-1097888251.eu-west-1.elb.amazonaws.com", "created_by": "agent", "stack_name": "dev-aws", "stack_version": "djcfg", "infrastructure_account": "aws:356702503974"},{"id": "elb-rin-12[aws:257146137867:eu-west-1]", "url": "https://rin-12-2117487812.eu-west-1.elb.amazonaws.com", "host": "rin-12-2117487812.eu-west-1.elb.amazonaws.com", "name": "rin-12", "type": "elb", "region": "eu-west-1", "dns_name": "rin-12-2117487812.eu-west-1.elb.amazonaws.com", "created_by": "agent", "infrastructure_account": "aws:257146137867"},{"id": "elb-fullstop-b4[aws:085668006708:eu-west-1]", "url": "https://fullstop-b4-702231031.eu-west-1.elb.amazonaws.com", "host": "fullstop-b4-702231031.eu-west-1.elb.amazonaws.com", "name": "fullstop-b4", "type": "elb", "region": "eu-west-1", "dns_name": "fullstop-b4-702231031.eu-west-1.elb.amazonaws.com", "created_by": "agent", "infrastructure_account": "aws:085668006708"},{"id": "elb-spilo-spiloPg-replica[aws:149830196184:eu-west-1]", "url": "https://internal-spilo-spiloPg-replica-804300867.eu-west-1.elb.amazonaws.com", "host": "internal-spilo-spiloPg-replica-804300867.eu-west-1.elb.amazonaws.com", "name": "spilo-spiloPg-replica", "type": "elb", "region": "eu-west-1", "scheme": "internal", "dns_name": "internal-spilo-spiloPg-replica-804300867.eu-west-1.elb.amazonaws.com", "created_by": "agent", "stack_name": "spilo-spiloPg", "stack_version": "replica", "infrastructure_account": "aws:149830196184"},{"id": "elb-fullstop-b6[aws:085668006708:eu-west-1]", "url": "https://fullstop-b6-1484228883.eu-west-1.elb.amazonaws.com", "host": "fullstop-b6-1484228883.eu-west-1.elb.amazonaws.com", "name": "fullstop-b6", "type": "elb", "region": "eu-west-1", "dns_name": "fullstop-b6-1484228883.eu-west-1.elb.amazonaws.com", "created_by": "agent", "infrastructure_account": "aws:085668006708"},{"id": "elb-si-spy-9[aws:007149717068:eu-west-1]", "url": "https://si-spy-9-1461369107.eu-west-1.elb.amazonaws.com", "host": "si-spy-9-1461369107.eu-west-1.elb.amazonaws.com", "name": "si-spy-9", "type": "elb", "region": "eu-west-1", "dns_name": "si-spy-9-1461369107.eu-west-1.elb.amazonaws.com", "created_by": "agent", "infrastructure_account": "aws:007149717068"},{"id": "elb-lawang-2[aws:352469958076:eu-west-1]", "url": "https://lawang-2-1170492050.eu-west-1.elb.amazonaws.com", "host": "lawang-2-1170492050.eu-west-1.elb.amazonaws.com", "name": "lawang-2", "type": "elb", "region": "eu-west-1", "dns_name": "lawang-2-1170492050.eu-west-1.elb.amazonaws.com", "created_by": "agent", "infrastructure_account": "aws:352469958076"},{"id": "elb-bukuwebui-3[aws:257146137867:eu-west-1]", "url": "https://internal-bukuwebui-3-1490588934.eu-west-1.elb.amazonaws.com", "host": "internal-bukuwebui-3-1490588934.eu-west-1.elb.amazonaws.com", "name": "bukuwebui-3", "type": "elb", "region": "eu-west-1", "dns_name": "internal-bukuwebui-3-1490588934.eu-west-1.elb.amazonaws.com", "created_by": "agent", "infrastructure_account": "aws:257146137867"}]);
        });
   });

    afterEach(function() {
        httpBackend.verifyNoOutstandingExpectation();
        httpBackend.verifyNoOutstandingRequest();
    });

    it('should initially have 5 teams and 5 apps', function() {
        httpBackend.expectGET('rest/entities/?query=%7B%22type%22%3A%22application%22%7D');
        httpBackend.expectGET('rest/entities/?query=%7B%22type%22%3A%22team%22%7D');
        httpBackend.expectGET('rest/entities/?query=%7B%22type%22%3A%22instance%22%7D');
        httpBackend.expectGET('rest/entities/?query=%7B%22type%22%3A%22elb%22%7D');
        httpBackend.flush();
        expect(scope.teams.length).toBe(5);
        expect(_.keys(scope.applications).length).toBe(5);
        expect(_.keys(scope.applications).length).toBe(5);
    });
});
